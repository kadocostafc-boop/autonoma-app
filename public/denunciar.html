<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Denunciar profissional • Autônoma.app</title>

  <!-- SEO / Social -->
  <link rel="canonical" href="https://autonomaapp.com.br/denunciar.html">
  <meta name="description" content="Envie uma denúncia sobre um profissional listado no Autônoma. Nosso time analisará o caso.">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Autônoma.app">
  <meta property="og:title" content="Denunciar profissional • Autônoma">
  <meta property="og:description" content="Envie uma denúncia sobre um profissional listado no Autônoma.">
  <meta property="og:url" content="https://autonomaapp.com.br/denunciar.html">
  <meta property="og:image" content="https://autonomaapp.com.br/img/og-cover.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#2d6cdf">

  <!-- PWA / Ícones -->
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="icon" href="/favicon.ico">

  <!-- CSS global -->
  <link rel="stylesheet" href="/css/global.css">

  <style>
    .header { display:flex; align-items:center; gap:12px; padding:12px 16px; }
    .header .logo { height:32px; width:auto; display:block; }
    .wrap-narrow{ max-width:820px; margin:0 auto; padding:16px; }
    .hint { font-size:12px; color:#64748b; }
    .ok { border:1px solid #bbf7d0; background:#ecfccb; border-radius:12px; padding:10px; }
    .err { color:#b91c1c; }
    .meta { color:#64748b; }
    .field{ display:flex; flex-direction:column; gap:6px; margin-bottom:10px }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap }
  </style>
</head>
<body>
  <header class="header">
    <a href="/" aria-label="Início">
      <img src="/img/logo.png" alt="Autônoma.app" class="logo" onerror="this.style.display='none'">
    </a>
    <div style="margin-left:auto;display:flex;gap:8px">
      <a class="btn ghost" href="/">Início</a>
      <a class="btn outline" href="/clientes.html">Buscar profissionais</a>
    </div>
  </header>

  <main class="wrap-narrow">
    <div class="card">
      <h1 style="margin:0">Denunciar profissional</h1>
      <p class="meta">Use este formulário para relatar problemas como fraude, atendimento inadequado ou spam. Analisaremos sua denúncia.</p>
    </div>

    <div id="ok" class="card ok" style="display:none">
      <strong>✅ Denúncia enviada!</strong>
      <div class="meta">Obrigado por nos ajudar a manter a plataforma segura. Sua denúncia será analisada.</div>
      <div class="row" style="margin-top:8px">
        <a id="okPerfil" class="btn">Voltar ao perfil</a>
        <a class="btn ghost" href="/clientes.html">Ir para a busca</a>
      </div>
    </div>

    <div id="formCard" class="card">
      <form id="formDen" method="POST" novalidate>
        <div class="field">
          <label for="profissionalId">ID do profissional *</label>
          <input id="profissionalId" name="profissionalId" type="number" inputmode="numeric" required placeholder="Ex.: 123">
          <div class="hint">Você pode abrir o perfil e copiar o número no fim da URL (ex.: /profissional/<strong>123</strong>).</div>
        </div>

        <div class="field">
          <label for="motivo">Motivo *</label>
          <select id="motivo" name="motivo" required>
            <option value="">Selecione…</option>
            <option value="fraude">Possível fraude / perfil falso</option>
            <option value="conduta">Conduta inadequada / ofensa</option>
            <option value="spam">Spam / publicidade indevida</option>
            <option value="informacao">Informações incorretas</option>
            <option value="outros">Outros</option>
          </select>
        </div>

        <div class="field">
          <label for="descricao">Descrição detalhada *</label>
          <textarea id="descricao" name="descricao" rows="6" maxlength="2000" placeholder="Explique o ocorrido com detalhes (mínimo 10 caracteres)." required></textarea>
          <div class="hint">Evite dados sensíveis de terceiros. Não publique informações pessoais sem consentimento.</div>
        </div>

        <div class="field">
          <label for="contato">Seu contato (opcional)</label>
          <input id="contato" name="contato" type="text" placeholder="E-mail ou telefone para retorno (opcional)">
          <div class="hint">Se precisar, entraremos em contato por e-mail ou telefone. Ex.: seuemail@dominio.com ou +551198887766.</div>
        </div>

        <div class="row" style="margin-top:6px">
          <button class="btn" type="submit">Enviar denúncia</button>
          <a id="voltarPerfil" class="btn ghost" style="display:none">Voltar ao perfil</a>
          <a class="btn ghost" href="/clientes.html">Cancelar</a>
        </div>

        <p id="err" class="meta err" style="display:none;margin-top:8px"></p>
      </form>
    </div>
  </main>

  <div class="foot">
    <a href="/termos-de-uso.html">Termos de Uso</a><span>•</span>
    <a href="/politica-de-privacidade.html">Política de Privacidade</a>
  </div>

  <script>
    (function(){
      const $ = (s)=> document.querySelector(s);
      const params = new URLSearchParams(location.search);
      const preId = Number(params.get("profissional")||"");
      const idEl = $("#profissionalId");
      const motivoEl = $("#motivo");
      const descEl = $("#descricao");
      const contatoEl = $("#contato");
      const errEl = $("#err");
      const okBox = $("#ok");
      const okPerfil = $("#okPerfil");
      const voltarPerfil = $("#voltarPerfil");
      const formCard = $("#formCard");

      if (preId) {
        idEl.value = String(preId);
        voltarPerfil.href = "/profissional/" + preId;
        voltarPerfil.style.display = "";
      }

      function showErr(msg){
        errEl.textContent = msg;
        errEl.style.display = "";
      }
      function clearErr(){ errEl.style.display = "none"; errEl.textContent = ""; }

      document.getElementById("formDen").addEventListener("submit", async (e)=>{
        e.preventDefault();
        clearErr();

        const profissionalId = Number(idEl.value);
        const motivo = String(motivoEl.value||"").trim();
        const descricao = String(descEl.value||"").trim();
        const contato = String(contatoEl.value||"").trim();

        const errors = [];
        if (!Number.isFinite(profissionalId) || profissionalId<=0) errors.push("Informe um ID de profissional válido.");
        if (!motivo) errors.push("Selecione um motivo.");
        if (!descricao || descricao.length < 10) errors.push("Descreva o ocorrido (mínimo 10 caracteres).");
        if (contato) {
          const isEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(contato);
          const isPhone = /^\+?\d[\d\s\-().]{6,}$/.test(contato);
          if (!isEmail && !isPhone) errors.push("Contato inválido: use e-mail OU telefone.");
        }

        if (errors.length){ showErr(errors.join(" ")); return; }

        try{
          const r = await fetch("/api/denuncias", {
            method: "POST",
            headers: { "Content-Type":"application/json" },
            body: JSON.stringify({ profissionalId, motivo, descricao, contato })
          });
          const js = await r.json().catch(()=> ({}));
          if (!r.ok || !js.ok){
            const msg = js && js.error ? js.error : "Não foi possível enviar sua denúncia.";
            showErr(msg); return;
          }

          // Sucesso
          formCard.style.display = "none";
          okBox.style.display = "";
          okPerfil.href = "/profissional/" + profissionalId;

        }catch(_){
          showErr("Falha de conexão. Tente novamente.");
        }
      });
    })();
  </script>
</body>
</html>