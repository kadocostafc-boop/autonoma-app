<!doctype html><html lang="pt-BR"><head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Top 10 Profissionais ‚Ä¢ Aut√¥noma.app</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#1f4bd8">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css">
  <style>
    .wrap{max-width:1120px;margin:0 auto;padding:16px}
    .grid{display:grid;gap:12px;grid-template-columns:1fr}
    @media(min-width:760px){.grid{grid-template-columns:1fr 1fr}}
    @media(min-width:1100px){.grid{grid-template-columns:1fr 1fr 1fr}}
    .card-pro{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:12px;display:flex;gap:10px;align-items:center}
    .photo{width:64px;height:64px;border-radius:12px;object-fit:cover;border:1px solid #e5e7eb;background:#f8fafc}
    .name{margin:0;font-weight:900}
    .muted{color:#64748b}
    .rating{color:#f59e0b}
    .btn{padding:8px 12px;border-radius:10px}
  </style>
</head><body>
  <header class="header">
    <img src="/icons/icon-192.png" alt="Aut√¥noma.app" class="logo"/>
    <div class="brand">
      <strong>Aut√¥noma<span class="dot">.app</span></strong>
      <span class="tag">Top 10</span>
    </div>
    <div style="margin-left:auto;display:flex;gap:8px">
      <a class="btn ghost" href="/">In√≠cio</a>
      <a class="btn outline" href="/clientes.html">Buscar</a>
      <a class="btn outline" href="/favoritos.html">Favoritos</a>
    </div>
  </header>

  <main class="wrap">
    <div class="card">
      <h1 style="margin:0">üèÜ Top 10 profissionais</h1>
      <p class="meta">Baseado em avalia√ß√µes, atendimento e relev√¢ncia recente.</p>
    </div>
    <section id="list" class="grid" aria-live="polite"></section>
    <div id="err" class="card meta" style="display:none">N√£o foi poss√≠vel carregar o Top 10.</div>
  </main>

<script>
async function fetchTop10(){
  const q = new URLSearchParams();
  const cidade = $('cidade').value.trim();
  const servico = $('servico').value.trim();
  if (cidade) q.set('cidade', cidade);
  if (servico) q.set('servico', servico);
  q.set('ts', Date.now());

  try{
    $('loader').style.display='';
    const r = await fetch('/api/top10?'+q.toString(), NO_STORE);
    if(!r.ok) throw new Error('HTTP '+r.status);
    const js = await r.json();

    // Aceita Ok/ok e items/itens/data
    const week = js.week || js.semana || '';
    $('weekLabel').textContent = week ? `Semana: ${week}` : 'Semana atual';

    const items = Array.isArray(js.items) ? js.items
                : Array.isArray(js.itens) ? js.itens
                : Array.isArray(js.data)  ? js.data
                : [];

    setCount(items.length);
    $('results').innerHTML = items.length
      ? items.map((p,i)=>cardHTML(p,i)).join('')
      : `<div class="muted" style="padding:10px">Nenhum profissional no Top 10 com os filtros atuais.</div>`;
  }catch(e){
    console.warn('top10 erro:', e);
    $('results').innerHTML = `<div class="muted" style="padding:10px">Falha ao carregar o ranking. Tente novamente.</div>`;
  }finally{
    $('loader').style.display='none';
  }
}
</script>
</body></html>