<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Encontre profissionais ‚Ä¢ Aut√¥noma.app</title>

  <!-- SEO/PWA b√°sicos -->
  <link rel="canonical" href="https://autonomaapp.com.br/clientes.html">
  <meta name="description" content="Busque profissionais perto de voc√™. Filtre por bairro e tipo de servi√ßo. Veja dist√¢ncia, atendimentos e avalia√ß√µes.">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#2563eb">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16.png">
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Aut√¥noma.app">
  <meta property="og:title" content="Encontre profissionais">
  <meta property="og:description" content="Profissionais por perto, com avalia√ß√µes e contato direto.">
  <meta property="og:image" content="https://autonomaapp.com.br/img/og-cover.png">
  <meta property="og:url" content="https://autonomaapp.com.br/clientes.html">

  <link rel="stylesheet" href="/css/app.css?v=2025-09-06-4">
  <style>
    /* ===== Ajustes espec√≠ficos desta p√°gina ===== */
    .wrap{max-width:1120px;margin:0 auto;padding:16px}
    .header{display:flex;align-items:center;gap:12px;padding:12px 16px}
    .header .logo{height:32px;width:auto;display:block}
    .topbar-links{ margin-left:auto; display:flex; gap:8px; flex-wrap:wrap }

    .filters{ display:grid; gap:10px; grid-template-columns:1fr; }
    @media(min-width:720px){ .filters{ grid-template-columns:1.2fr 1fr 1fr .8fr auto } }

    /* Grid de resultados */
    .results-grid{ display:grid; gap:12px; grid-template-columns:1fr; }
    @media(min-width:720px){ .results-grid{ grid-template-columns:1fr 1fr } }
    @media(min-width:1060px){ .results-grid{ grid-template-columns:1fr 1fr 1fr } }

    /* ===== Card do profissional (layout vertical, foto circular) ===== */
    .pro-card{
      background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:14px;
      display:flex; flex-direction:column; gap:10px;
      transition: box-shadow .18s ease, transform .18s ease;
    }
    .pro-card:hover{ box-shadow:0 8px 20px rgba(0,0,0,.06); transform:translateY(-2px) }
    .pro-top{ display:flex; align-items:center; gap:12px }
    .pro-avatar{
      width:88px; height:88px; border-radius:999px; object-fit:cover;
      border:1px solid #e5e7eb; background:#f8fafc;
    }
    .pro-info h3{ margin:0 0 2px; font-size:18px; line-height:1.2 }
    .serv-local{ color:#64748b; font-size:14px }
    .rating-row{ display:flex; align-items:center; gap:6px; font-size:14px }
    .star{ color:#f59e0b; font-size:16px }
    .stats-row{
      display:flex; flex-wrap:wrap; gap:12px; font-size:13px; color:#64748b;
    }
    .distance{ font-variant-numeric:tabular-nums }
    .pro-actions{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:6px; }
    .btn.small{ padding:8px 12px; font-size:14px }

    /* Badges de plano */
    .badge{ display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #e5e7eb; font-size:12px }
    .badge-pro{ background:#eef2ff; border-color:#c7d2fe; color:#3730a3; font-weight:700 }
    .badge-premium{ background:#fff7ed; border-color:#fed7aa; color:#9a3412; font-weight:700 }

    .muted{ color:#64748b }
    .subtle{ color:#94a3b8 }
    .tag{ display:inline-flex; align-items:center; gap:6px; font-size:12px; padding:4px 8px; border:1px solid #e5e7eb; border-radius:999px; background:#f8fafc }
    .loader{ display:none; font-size:14px }
    .gps-ok{ color:#059669; }
    .gps-warn{ color:#b45309; }

    /* Logger de erros (aparece no topo no mobile) */
    .devlog{position:sticky;top:0;z-index:50;margin:0 0 8px;padding:8px 10px;border-radius:10px;background:#fff7ed;border:1px solid #fed7aa;color:#7c2d12;font-size:12px;display:none}
    .devlog.show{display:block}
    .devlog b{font-weight:800}
    /* Rodap√© */
    footer { padding: 28px 12px; background:#0b1f63; margin-top:16px }
    .foot-links { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; }
    .foot-links a { color:#cde1ff; font-size:14px; text-decoration:none; }
    .foot-links a:hover { text-decoration:underline; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header" role="banner">
    <a href="/" aria-label="In√≠cio">
      <img class="logo" src="/img/logo.png" alt="Aut√¥noma.app" onerror="this.style.display='none'">
    </a>
    <nav class="topbar-links" aria-label="Navega√ß√£o principal">
      <a class="btn ghost" href="/?v=2025-09-06-4">In√≠cio</a>
      <a class="btn ghost" href="/top10.html?v=2025-09-06-4">üèÜ Top 10</a>
      <a class="btn ghost" href="/planos.html?v=2025-09-06-4">‚≠ê Planos</a>
      <a class="btn outline" href="/painel_login.html?v=2025-09-06-4">üîê Entrar no Painel</a>
      <a class="btn" href="/cadastro.html?v=2025-09-06-4">‚ûï Cadastrar Profissional</a>
    </nav>
  </header>

  <main class="wrap" role="main">
    <div id="devlog" class="devlog" aria-live="polite"></div>

    <div class="card">
      <h1 class="mt-0">Encontre profissionais</h1>
      <p class="meta">
        Deixe simples: escolha <strong>bairro</strong> e <strong>servi√ßo</strong>.
        Se permitir o GPS, mostramos quem est√° mais perto (com <span class="badge">Radar</span> ou endere√ßo fixo).
      </p>

      <!-- Prefer√™ncias/GPS -->
      <div class="row" style="gap:10px; align-items:center; flex-wrap:wrap; margin:8px 0 12px">
        <label class="pill" style="gap:8px">
          <input id="useGPS" type="checkbox" />
          Usar minha localiza√ß√£o
        </label>
        <span id="gpsStatus" class="small muted">GPS desativado.</span>
      </div>

      <!-- Filtros -->
      <form id="formBusca" class="filters" role="search" aria-label="Filtros de busca" novalidate>
        <div>
          <label for="cidade">Cidade</label>
          <input id="cidade" name="cidade" type="text" placeholder="Ex.: Rio de Janeiro/RJ" list="listaCidades" autocomplete="off">
          <datalist id="listaCidades"></datalist>
        </div>
        <div>
          <label for="bairro">Bairro</label>
          <input id="bairro" name="bairro" type="text" placeholder="Ex.: Copacabana" list="listaBairros" autocomplete="off">
          <datalist id="listaBairros"></datalist>
        </div>
        <div>
          <label for="servico">Servi√ßo</label>
          <input id="servico" name="servico" type="text" placeholder="Ex.: Eletricista" list="listaServicos" autocomplete="off">
          <datalist id="listaServicos"></datalist>
        </div>
        <div>
          <label for="minRating">Melhor avalia√ß√£o (opcional)</label>
          <select id="minRating" name="minRating">
            <option value="">Qualquer</option>
            <option value="3">3+ ‚≠ê</option>
            <option value="4">4+ ‚≠ê</option>
            <option value="4.5">4.5+ ‚≠ê</option>
          </select>
        </div>
        <div style="display:flex; gap:8px; align-items:flex-end">
          <button class="btn" type="submit" id="btnBuscar">Buscar</button>
          <button class="btn ghost" type="button" id="btnLimpar">Limpar</button>
        </div>
      </form>

      <!-- Estado -->
      <div class="row" style="margin-top:10px; align-items:center; gap:10px; flex-wrap:wrap">
        <span class="tag" id="tagCidade" style="display:none"></span>
        <span class="tag" id="tagBairro" style="display:none"></span>
        <span class="tag" id="tagServico" style="display:none"></span>
        <span class="tag" id="tagRating" style="display:none"></span>
        <span class="loader" id="loader">Carregando resultados‚Ä¶</span>
      </div>
    </div>

    <!-- Resultados -->
    <section id="results" class="results-grid" aria-live="polite"></section>

    <!-- Pagina√ß√£o -->
    <div class="card" id="paginacao" style="text-align:center; display:none">
      <button id="btnMais" class="btn">Carregar mais</button>
      <p id="contagem" class="small muted" style="margin-top:6px"></p>
    </div>

    <!-- Dicas -->
    <div class="card">
      <p class="dica-forte">üí° Para ver mais detalhes, avalia√ß√µes e favoritar/recomendar, abra o perfil do profissional.</p>
    </div>
  </main>

  <!-- Rodap√© (links mantidos) -->
  <footer>
    <nav class="foot-links" aria-label="Links do rodap√©">
      <a href="/termos.html?v=2025-09-06-4">Termos</a>
      <a href="/privacidade.html?v=2025-09-06-4">Privacidade</a>
      <a href="/top10.html?v=2025-09-06-4">Top 10</a>
      <a href="/planos.html?v=2025-09-06-4">Planos</a>
      <a href="/politica-de-seguranca.html?v=2025-09-06-4">Seguran√ßa</a>
      <a href="/favoritos.html?v=2025-09-06-4">Favoritos</a>
    </nav>
  </footer>

  <script>
  (function(){
    // ---------- Utils ----------
    const $ = (id)=> document.getElementById(id);
    const logEl = $('devlog');
    const log = (msg)=>{ try{ logEl.innerHTML = msg; logEl.classList.add('show'); }catch{} };
    window.addEventListener('error', e=>log('<b>Erro:</b> '+(e.message||'desconhecido')));
    window.addEventListener('unhandledrejection', e=>log('<b>Falha:</b> '+(e.reason?.message||'promessa rejeitada')));

    const esc = (s)=> String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");
    const estrelas = (n)=>{ const r=Math.round((Number(n)||0)*2)/2; const f=Math.floor(r),h=(r%1!==0); return "‚òÖ".repeat(f)+(h?"¬Ω":"")+"‚òÜ".repeat(5-f-(h?1:0)); };
    const kmFmt = (d)=> (d==null || !isFinite(d) ? "‚Äî" : (d<1 ? `${(d*1000).toFixed(0)} m` : `${Number(d).toFixed(d<10?1:0)} km`));
    const NO_STORE = { cache:'no-store' };

    // ---------- Estado ----------
    let userLat=null, userLng=null, useGPS=false;
    let page=1, limit=20, total=0, acumulados=0;
    let lastQuery={ cidade:"", bairro:"", servico:"", minRating:"" };

    // ---------- Autocomplete ----------
    async function fillCidadesBase(){
      try{
        const r = await fetch('/api/geo/cidades', NO_STORE);
        if(!r.ok) return;
        const js = await r.json();
        $('listaCidades').innerHTML=(js||[]).map(c=>`<option value="${esc(c)}">`).join('');
      }catch(e){ log('Cidades: '+e.message); }
    }
    async function suggestCidades(q){
      if(!q) return [];
      try{
        const r = await fetch('/api/geo/cidades/suggest?q='+encodeURIComponent(q), NO_STORE);
        return r.ok ? (await r.json()) : [];
      }catch{ return []; }
    }
    async function suggestBairros(q){
      const cid=$('cidade').value.trim();
      if(!cid||!q) return [];
      const r=await fetch(`/api/geo/bairros/suggest?cidade=${encodeURIComponent(cid)}&q=${encodeURIComponent(q)}`, NO_STORE);
      return r.ok?(await r.json()):[];
    }
    async function loadBairrosDaCidade(cidadeVal){
      if(!cidadeVal) { $('listaBairros').innerHTML=''; return; }
      try{
        const r = await fetch('/api/geo/bairros?cidade='+encodeURIComponent(cidadeVal), NO_STORE);
        if(!r.ok) return;
        const js = await r.json();
        $('listaBairros').innerHTML = (js||[]).map(b=>`<option value="${esc(b)}">`).join('');
      }catch{}
    }
    async function suggestServicos(q){
      if(!q) return [];
      const r=await fetch(`/api/geo/servicos/suggest?q=${encodeURIComponent(q)}`, NO_STORE);
      return r.ok?(await r.json()):[];
    }

    $('cidade').addEventListener('input', async e=>{
      const v = e.target.value.trim();
      try{
        const list = await suggestCidades(v);
        $('listaCidades').innerHTML = list.map(c=>`<option value="${esc(c)}">`).join('');
      }catch{}
      $('bairro').value = '';
      await loadBairrosDaCidade(v);
    });
    $('bairro').addEventListener('input', async e=>{
      const v=e.target.value.trim();
      const list=await suggestBairros(v);
      $('listaBairros').innerHTML=list.map(b=>`<option value="${esc(b)}">`).join('');
    });
    $('servico').addEventListener('input', async e=>{
      const v=e.target.value.trim();
      const list=await suggestServicos(v);
      $('listaServicos').innerHTML=list.map(s=>`<option value="${esc(s)}">`).join('');
    });

    // ---------- GPS (opcional, n√£o bloqueia lista) ----------
    function isSecureForGeo(){
      return location.hostname==='localhost' || location.hostname==='127.0.0.1' || (window.isSecureContext===true);
    }
    async function resolveCityByGPS(lat,lng){
      try{
        const r=await fetch(`/api/geo/closest-city?lat=${lat}&lng=${lng}`, NO_STORE);
        const js=await r.json();
        if(js&&js.ok&&js.cidade){
          $('cidade').value=js.cidade;
          showTag('tagCidade','Cidade: '+js.cidade);
          await loadBairrosDaCidade(js.cidade);
        }
      }catch{}
    }
    async function askGPS(){
      if(!isSecureForGeo()){
        $('gpsStatus').innerHTML='<span class="gps-warn">Para usar GPS, acesse via HTTPS ou localhost.</span>';
        useGPS=false; $('useGPS').checked=false;
        return;
      }
      if(!('geolocation' in navigator)){
        $('gpsStatus').textContent='Seu navegador n√£o suporta geolocaliza√ß√£o.';
        useGPS=false; $('useGPS').checked=false;
        return;
      }
      $('gpsStatus').textContent='Solicitando localiza√ß√£o‚Ä¶';
      navigator.geolocation.getCurrentPosition(async pos=>{
        userLat=pos.coords.latitude; userLng=pos.coords.longitude;
        $('gpsStatus').innerHTML='<span class="gps-ok">Localiza√ß√£o ativada.</span>';
        if(!$('cidade').value.trim()) await resolveCityByGPS(userLat,userLng);
        if(useGPS && ( $('bairro').value || $('servico').value )) submitBusca();
      }, _=>{
        $('gpsStatus').innerHTML='<span class="gps-warn">N√£o foi poss√≠vel obter a localiza√ß√£o.</span>';
        useGPS=false; $('useGPS').checked=false;
      }, {enableHighAccuracy:true,timeout:12000,maximumAge:30000});
    }
    $('useGPS').addEventListener('change', e=>{
      useGPS=!!e.target.checked;
      if(useGPS) askGPS();
      else { $('gpsStatus').textContent='GPS desativado.'; userLat=null; userLng=null; }
    });

    // ---------- UI helpers ----------
    function showLoader(on){ $('loader').style.display = on? '' : 'none'; }
    function showTag(id, txt){ const el=$(id); el.textContent=txt; el.style.display='inline-flex'; }
    function hideTags(){ ['tagCidade','tagBairro','tagServico','tagRating'].forEach(id=>$(id).style.display='none'); }
    function resetResults(){ $('results').innerHTML=''; page=1; total=0; acumulados=0; $('paginacao').style.display='none'; $('contagem').textContent=''; }
    function applyStateTags(q){
      hideTags();
      if(q.cidade) showTag('tagCidade','Cidade: '+q.cidade);
      if(q.bairro) showTag('tagBairro','Bairro: '+q.bairro);
      if(q.servico) showTag('tagServico','Servi√ßo: '+q.servico);
      if(q.minRating) showTag('tagRating','Avalia√ß√£o: '+q.minRating+'+');
    }

    // ---------- Busca + Fallbacks ----------
    async function fetchAPI(params){
      const url = '/api/profissionais?' + params.toString();
      const r = await fetch(url, NO_STORE);
      if(!r.ok) throw new Error('HTTP '+r.status);
      return await r.json();
    }
    async function fetchDestaquesFallback(){
      try{
        const p = new URLSearchParams({ sort:'score', dir:'desc', page:'1', limit:'12' });
        return await fetchAPI(p);
      }catch(e){
        // √öltimo fallback: tentar um arquivo est√°tico (se existir)
        try{
          const r = await fetch('/data/profissionais.json', NO_STORE);
          if(!r.ok) return { total:0, items:[] };
          const arr = await r.json();
          return { total: arr.length, items: arr.slice(0,12) };
        }catch{ return { total:0, items:[] }; }
      }
    }

    async function fetchProfissionais(isLoadMore=false){
      const params = new URLSearchParams();
      if(lastQuery.cidade) params.set('cidade', lastQuery.cidade);
      if(lastQuery.bairro)  params.set('bairro', lastQuery.bairro);
      if(lastQuery.servico) params.set('servico', lastQuery.servico);
      if(lastQuery.minRating) params.set('minRating', lastQuery.minRating);
      params.set('sort','score'); params.set('dir','desc');
      params.set('page', String(page)); params.set('limit', String(limit));
      if(useGPS && userLat!=null && userLng!=null){
        params.set('userLat', String(userLat));
        params.set('userLng', String(userLng));
      }

      showLoader(true);
      try{
        let js = await fetchAPI(params);
        // Se vazio no primeiro carregamento, tenta "Destaques"
        if(!isLoadMore && (!js || (js.items||[]).length===0)){
          js = await fetchDestaquesFallback();
          if(js && (js.items||[]).length){
            log('<b>Dica:</b> mostrando destaques porque a busca veio vazia.');
          }
        }
        total = js.total||0;
        renderResults(js.items||[], isLoadMore);
        acumulados += (js.items||[]).length;
        if(acumulados < total){
          $('paginacao').style.display='';
          $('contagem').textContent=`${acumulados}/${total} exibidos`;
        } else {
          $('paginacao').style.display='none';
        }
      }catch(e){
        log('Falha ao buscar profissionais: '+e.message);
        if(!isLoadMore) $('results').innerHTML = `<div class="card"><p class="err">Falha ao carregar resultados. Tente novamente.</p></div>`;
      }finally{
        showLoader(false);
      }
    }

    function badgeHTML(plano){
      if((plano||'').toLowerCase()==='premium') return `<span class="badge badge-premium">PREMIUM</span>`;
      if((plano||'').toLowerCase()==='pro') return `<span class="badge badge-pro">PRO</span>`;
      return '';
    }

    function renderResults(items, isLoadMore){
      const grid = $('results');
      const html = (items||[]).map((p)=>{
        const item = {
          id: p.id,
          nome: p.nome,
          servico: p.servico || p.profissao || '',
          bairro: p.bairro || '',
          cidade: p.cidade || '',
          foto: p.foto || '',
          whatsapp: p.whatsapp || '',
          rating: Number(p.rating||0),
          avaliacoes: Number(p.avaliacoes||0),
          atendimentos: Number(p.atendimentos||0),
          experienciaAnos: p.experienciaAnos || p.experiencia || 0,
          chamadas: p.chamadas || 0,
          visitas: p.visitas || 0,
          precoBase: p.precoBase || p.preco || '',
          site: p.site || p.catalogo || '',
          distanceKm: (p.distanceKm ?? p.dist ?? p.distanciaKm ?? null),
          plano: (p.plano||'').toLowerCase()
        };
        const distSpan = (item.distanceKm!=null && isFinite(item.distanceKm))
          ? `<span class="muted distance">Dist√¢ncia: <strong>${kmFmt(item.distanceKm)}</strong></span>`
          : '';
        const stars = estrelas(item.rating);
        const local = [item.bairro, item.cidade].filter(Boolean).join(' ‚Äì ');
        const foto = item.foto ? esc(item.foto) : '/icons/icon-192.png';
        const id = encodeURIComponent(item.id);
        return `
          <article class="pro-card">
            <div class="pro-top">
              <img class="pro-avatar" src="${foto}" alt="Foto de ${esc(item.nome)}" width="88" height="88" loading="lazy" onerror="this.src='/icons/icon-192.png'">
              <div class="pro-info">
                <h3>${esc(item.nome)} ${badgeHTML(item.plano)}</h3>
                <div class="serv-local">${esc(item.servico)} ‚Ä¢ <span class="muted">${esc(local||'‚Äî')}</span></div>
              </div>
            </div>
            <div class="rating-row">
              <span class="star">${stars}</span>
              <span class="muted">(${item.avaliacoes})</span>
            </div>
            <div class="stats-row">
              <span class="muted">Atendimentos: <strong>${item.atendimentos}</strong></span>
              ${distSpan}
            </div>
            <div class="pro-actions">
              <a class="btn small" href="/perfil.html?id=${id}" aria-label="Ver perfil de ${esc(item.nome)}">Ver perfil</a>
            </div>
          </article>
        `;
      }).join('');
      if(isLoadMore) grid.insertAdjacentHTML('beforeend', html);
      else grid.innerHTML = html || `<div class="card"><p class="meta">Nenhum profissional encontrado com os filtros atuais.</p></div>`;
    }

    // ---------- Eventos ----------
    function submitBusca(){
      lastQuery = {
        cidade: $('cidade').value.trim(),
        bairro: $('bairro').value.trim(),
        servico: $('servico').value.trim(),
        minRating: $('minRating').value.trim()
      };
      applyStateTags(lastQuery);
      resetResults();
      fetchProfissionais(false);
    }
    document.getElementById('formBusca').addEventListener('submit', (e)=>{ e.preventDefault(); submitBusca(); });
    document.getElementById('btnLimpar').addEventListener('click', async ()=>{
      $('cidade').value=''; $('bairro').value=''; $('servico').value=''; $('minRating').value='';
      hideTags(); resetResults(); await fillCidadesBase(); fetchProfissionais(false);
    });
    document.getElementById('btnMais').addEventListener('click', ()=>{ if(acumulados < total){ page++; fetchProfissionais(true); } });

    // ---------- Boot ----------
    (async function init(){
      await fillCidadesBase();
      const u=new URL(location.href);
      const cid=u.searchParams.get('cidade')||'';
      const bai=u.searchParams.get('bairro')||'';
      const ser=u.searchParams.get('servico')||'';
      const mr =u.searchParams.get('minRating')||'';
      if(cid) { $('cidade').value=cid; await loadBairrosDaCidade(cid); }
      if(bai) $('bairro').value=bai;
      if(ser) $('servico').value=ser;
      if(mr) $('minRating').value=mr;
      // sempre tenta buscar algo (se vier vazio, cai no fallback de destaques)
      submitBusca();
    })();
  })();
  </script>
</body>
</html>