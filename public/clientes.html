<!doctype html><html lang="pt-BR"><head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Encontre profissionais • Autônoma.app</title>
  <!-- SEO/PWA -->
  <link rel="canonical" href="https://autonomaapp.com.br/clientes.html">
  <meta name="description" content="Busque profissionais perto de você. Filtre por bairro e tipo de serviço. Veja distância, preço, atendimentos e avaliações.">
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0b1f63">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16.png">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Autônoma.app">
  <meta property="og:title" content="Encontre profissionais">
  <meta property="og:description" content="Profissionais por perto, com avaliações e contato direto.">
  <meta property="og:image" content="https://autonomaapp.com.br/img/og-cover.png">
  <meta property="og:url" content="https://autonomaapp.com.br/clientes.html">
  <link rel="stylesheet" href="/css/app.css?v=clients-2025-09-08">
  <style>
    :root{ --azul-escuro:#0b1f63; --azul-brilho:#2D81FF; --azul-brilho-2:#1E6EF2; --cinza:#64748b; --cinza-claro:#f1f5f9; --borda:#e5e7eb; }
    .wrap{max-width:1120px;margin:0 auto;padding:16px}
    /* HEADER */
    .header{ background:var(--azul-escuro); padding:12px 16px; display:flex; gap:8px; align-items:center; justify-content:flex-end; }
    .nav-btn{ appearance:none; border:none; cursor:pointer; background:var(--azul-brilho); color:#fff; font-weight:800; padding:8px 12px; border-radius:10px; text-decoration:none; font-size:14px; display:inline-flex; align-items:center; justify-content:center; }
    .nav-btn:hover{ filter:brightness(.96); }
    /* HERO */
    .search-hero{ background: linear-gradient(180deg, var(--azul-brilho) 0%, var(--azul-brilho-2) 100%); color:#fff; margin:0 0 14px 0; padding: 20px 14px 16px; border-radius:18px; box-shadow: 0 10px 24px rgba(0,0,0,.10); }
    .search-hero h1{ margin:0 0 10px; font-size:26px; line-height:1.15; font-weight:900; letter-spacing:.2px; text-shadow: 0 1px 0 #e8f0ff, 0 10px 24px rgba(0,0,0,.22); }
    .gps-row{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin:8px 0 12px}
    .gps-row .pill{background:#ffffff20; border:1px solid #ffffff40; color:#fff; padding:6px 10px; border-radius:12px}
    .gps-row .muted{color:#e2ebff}
    .filters{ display:grid; gap:10px; grid-template-columns:1fr; background:#fff; border:1px solid #ffffff40; border-radius:14px; padding:12px; }
    @media(min-width:720px){ .filters{ grid-template-columns:1.2fr 1fr 1fr .8fr auto } }
    .filters label{color:#0f172a; font-weight:700; font-size:13px}
    .filters input, .filters select{ width:100%; border:1px solid var(--borda); border-radius:12px; padding:10px 12px; background:#fff; color:#0f172a; outline:none; }
    .btn{ border:none; background:var(--azul-brilho); color:#fff; padding:11px 14px; border-radius:12px; cursor:pointer; text-decoration:none; display:inline-flex; align-items:center; justify-content:center; font-weight:800 }
    .btn.ghost{ background:#fff; color:#0f172a; border:1px solid var(--borda) }
    .btn.dark{ background:var(--azul-escuro) }
    /* CARDS */
    .results-grid{ display:grid; gap:10px; grid-template-columns:1fr; }
    @media(min-width:720px){ .results-grid{ grid-template-columns:1fr 1fr } }
    @media(min-width:1060px){ .results-grid{ grid-template-columns:1fr 1fr 1fr } }
    .pro-card{ background:#fff; border:1px solid var(--borda); border-radius:16px; padding:10px 12px; display:flex; align-items:center; gap:12px; box-shadow: 0 6px 16px rgba(0,0,0,.06); transition:transform .16s ease, box-shadow .16s ease; }
    .pro-card:hover{ transform:translateY(-1px); box-shadow:0 10px 22px rgba(0,0,0,.09) }
    .pro-avatar{ width:56px; height:56px; border-radius:999px; object-fit:cover; border:1px solid var(--borda); background:#f8fafc; flex:0 0 56px }
    .pro-main{ flex:1 1 auto; min-width:0 }
    .pro-name{ margin:0; font-size:16px; font-weight:900; color:#0f172a; overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
    .pro-sub{ margin:2px 0 0; font-size:13px; color:var(--cinza) }
    .pro-right{ text-align:right; min-width:90px; display:flex; flex-direction:column; gap:2px; align-items:flex-end }
    .pro-right .dist{ font-size:13px; color:#0f172a; background:#eef2ff; border:1px solid #c7d2fe; border-radius:999px; padding:2px 8px }
    .pro-right .price{ font-size:13px; color:#0f172a; background:#f1f5ff; border:1px solid #e0e7ff; border-radius:999px; padding:2px 8px }
    .rating{ color:#f59e0b; font-size:13px; }
    .muted{ color:var(--cinza) }
    .tag{ display:inline-flex; align-items:center; gap:6px; font-size:12px; padding:4px 8px; border:1px solid var(--borda); border-radius:999px; background:#f8fafc }
    .loader{ display:none; font-size:14px }
    .gps-ok{ color:#22c55e } .gps-warn{ color:#f59e0b }
    .section-title{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .section-title h2{ margin:0; font-size:18px }
    .card{ background:#fff; border:1px solid var(--borda); border-radius:16px; padding:14px; }
    /* Flash error */
    #flashErr{display:none;margin:0 0 12px;background:#fff1f2;border:1px solid #fecdd3;color:#991b1b;border-radius:12px;padding:10px}
    footer { padding: 28px 12px; background:var(--azul-escuro); margin-top:16px }
    .foot-links { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; }
    .foot-links a { color:#cde1ff; font-size:14px; text-decoration:none; }
    .foot-links a:hover { text-decoration:underline; }
  </style></head><body>
  <!-- HEADER -->
  <header class="header" role="banner" aria-label="Cabeçalho">
    <a class="nav-btn" href="/">Início</a>
    <a class="nav-btn" href="/top10.html">Top 10</a>
    <a class="nav-btn" href="/painel_login.html">Entrar</a>
  </header>
  <main class="wrap" role="main">
    <div id="flashErr" role="alert"></div>
    <!-- HERO -->
    <section class="search-hero" aria-labelledby="hTitle">
      <h1 id="hTitle">Encontre profissionais qualificados</h1>
      <div class="gps-row">
        <label class="pill" style="gap:8px">
          <input id="useGPS" type="checkbox">
          Usar minha localização
        </label>
        <span id="gpsStatus" class="small muted">GPS desativado.</span>
      </div>
      <form id="formBusca" class="filters" role="search" aria-label="Filtros de busca" novalidate>
        <div>
          <label for="cidade">Cidade</label>
          <input id="cidade" name="cidade" type="text" placeholder="Ex.: Rio de Janeiro/RJ" list="listaCidades" autocomplete="off">
          <datalist id="listaCidades"></datalist>
        </div>
        <div>
          <label for="bairro">Bairro</label>
          <input id="bairro" name="bairro" type="text" placeholder="Ex.: Copacabana" list="listaBairros" autocomplete="off">
          <datalist id="listaBairros"></datalist>
        </div>
        <div>
          <label for="servico">Serviço</label>
          <input id="servico" name="servico" type="text" placeholder="Ex.: Eletricista" list="listaServicos" autocomplete="off">
          <datalist id="listaServicos"></datalist>
        </div>
        <div>
          <label for="minRating">Melhor avaliação (opcional)</label>
          <select id="minRating" name="minRating">
            <option value="">Qualquer</option>
            <option value="3">3+ ⭐</option>
            <option value="4">4+ ⭐</option>
            <option value="4.5">4.5+ ⭐</option>
          </select>
        </div>
        <div style="display:flex; gap:8px; align-items:flex-end">
          <button class="btn dark" type="submit" id="btnBuscar">Buscar</button>
          <button class="btn ghost" type="button" id="btnLimpar">Limpar</button>
        </div>
      </form>
      <div class="gps-row">
        <span class="tag" id="tagCidade" style="display:none"></span>
        <span class="tag" id="tagBairro" style="display:none"></span>
        <span class="tag" id="tagServico" style="display:none"></span>
        <span class="tag" id="tagRating" style="display:none"></span>
        <span class="loader" id="loader">Carregando…</span>
      </div>
    </section>

    <section id="results" class="results-grid" aria-live="polite"></section>

    <div class="card" id="paginacao" style="text-align:center; display:none">
      <button id="btnMais" class="btn">Carregar mais</button>
      <p id="contagem" class="small muted" style="margin-top:6px"></p>
    </div>

    <section class="card" aria-labelledby="destaquesTitle">
      <div class="section-title">
        <h2 id="destaquesTitle">Profissionais em destaque</h2>
        <small class="muted" id="destCount"></small>
      </div>
      <div id="destaques" class="results-grid" aria-live="polite"></div>
    </section>
  </main>

  <footer>
    <nav class="foot-links" aria-label="Links do rodapé">
      <a href="/termos.html">Termos</a>
      <a href="/privacidade.html">Privacidade</a>
      <a href="/top10.html">Top 10</a>
      <a href="/planos.html">Planos</a>
      <a href="/politica-de-seguranca.html">Segurança</a>
      <a href="/favoritos.html">Favoritos</a>
    </nav>
  </footer>

  <script>
  (function(){
    // Utils
    const $ = (id)=> document.getElementById(id);
    const flashErr = (msg)=>{ const el=$('flashErr'); el.textContent=msg; el.style.display=''; setTimeout(()=>{ el.style.display='none'; }, 6000); };
    const esc = (s)=> String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");
    const estrelas = (n)=>{ const r=Math.round((Number(n)||0)*2)/2; const f=Math.floor(r),h=(r%1!==0); return "★".repeat(f)+(h?"½":"")+"☆".repeat(5-f-(h?1:0)); };
    const kmFmt = (d)=> (d==null ? "—" : (d<1 ? ((d*1000).toFixed(0)+" m") : (Number(d).toFixed(d<10?1:0)+" km")));
    const NO_STORE = { cache:'no-store' };
    const ts = () => `ts=${Date.now()}`;

    // Haversine
    function hav(lat1, lon1, lat2, lon2){
      if([lat1,lon1,lat2,lon2].some(v=>!Number.isFinite(v))) return null;
      const toRad = d=> d*Math.PI/180, R=6371;
      const dLat = toRad(lat2-lat1), dLon=toRad(lon2-lon1);
      const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
      return 2*R*Math.asin(Math.sqrt(a));
    }

    // Estado
    let userLat=null, userLng=null, useGPS=false;
    let page=1, limit=20, total=0, acumulados=0;
    let lastQuery={ cidade:"", bairro:"", servico:"", minRating:"" };

    // Autocomplete
    async function fillCidades(){
      try{
        const r=await fetch(`/api/geo/cidades?${ts()}`, NO_STORE);
        if(!r.ok) return;
        const js=await r.json();
        $('listaCidades').innerHTML=(js||[]).map(c=>`<option value="${esc(c)}">`).join('');
      }catch{}
    }
    async function loadBairrosDaCidade(cidadeVal){
      if(!cidadeVal) { $('listaBairros').innerHTML=''; return; }
      try{
        const r = await fetch(`/api/geo/bairros?cidade=${encodeURIComponent(cidadeVal)}&${ts()}`, NO_STORE);
        if(!r.ok) return;
        const js = await r.json();
        $('listaBairros').innerHTML = (js||[]).map(b=>`<option value="${esc(b)}">`).join('');
      }catch{}
    }
    async function suggestBairros(q){
      const cid=$('cidade').value.trim();
      if(!cid||!q) return [];
      const r=await fetch(`/api/geo/bairros/suggest?cidade=${encodeURIComponent(cid)}&q=${encodeURIComponent(q)}&${ts()}`, NO_STORE);
      return r.ok?(await r.json()):[];
    }
    async function suggestServicos(q){
      if(!q) return [];
      const r=await fetch(`/api/geo/servicos/suggest?q=${encodeURIComponent(q)}&${ts()}`, NO_STORE);
      return r.ok?(await r.json()):[];
    }
    $('cidade').addEventListener('change', async e=>{
      const v=e.target.value.trim();
      $('bairro').value=''; await loadBairrosDaCidade(v);
    });
    $('bairro').addEventListener('input', async e=>{
      const v=e.target.value.trim();
      const list=await suggestBairros(v);
      $('listaBairros').innerHTML=list.map(b=>`<option value="${esc(b)}">`).join('');
    });
    $('servico').addEventListener('input', async e=>{
      const v=e.target.value.trim();
      const list=await suggestServicos(v);
      $('listaServicos').innerHTML=list.map(s=>`<option value="${esc(s)}">`).join('');
    });

    // GPS
    function isSecureForGeo(){
      return location.hostname==='localhost' || location.hostname==='127.0.0.1' || (window.isSecureContext===true);
    }
    async function resolveCityByGPS(lat,lng){
      try{
        const r=await fetch(`/api/geo/closest-city?lat=${lat}&lng=${lng}&${ts()}`, NO_STORE);
        const js=await r.json();
        if(js&&js.ok&&js.cidade){
          $('cidade').value=js.cidade;
          showTag('tagCidade','Cidade: '+js.cidade);
          await loadBairrosDaCidade(js.cidade);
        }
      }catch{}
    }
    async function askGPS(){
      if(!isSecureForGeo()){
        $('gpsStatus').innerHTML='<span class="gps-warn">Para usar GPS, acesse via HTTPS ou localhost.</span>';
        useGPS=false; $('useGPS').checked=false; return;
      }
      if(!('geolocation' in navigator)){
        $('gpsStatus').textContent='Seu navegador não suporta geolocalização.';
        useGPS=false; $('useGPS').checked=false; return;
      }
      $('gpsStatus').textContent='Solicitando localização…';
      navigator.geolocation.getCurrentPosition(async pos=>{
        userLat=pos.coords.latitude; userLng=pos.coords.longitude;
        $('gpsStatus').innerHTML='<span class="gps-ok">Localização ativada.</span>';
        if(!$('cidade').value.trim()) await resolveCityByGPS(userLat,userLng);
        if(useGPS && ( $('bairro').value || $('servico').value )) submitBusca();
      }, _=>{
        $('gpsStatus').innerHTML='<span class="gps-warn">Não foi possível obter a localização.</span>';
        useGPS=false; $('useGPS').checked=false;
      }, {enableHighAccuracy:true,timeout:12000,maximumAge:30000});
    }
    $('useGPS').addEventListener('change', e=>{
      useGPS=!!e.target.checked;
      if(useGPS) askGPS();
      else { $('gpsStatus').textContent='GPS desativado.'; userLat=null; userLng=null; }
    });

    // UI helpers
    function showTag(id, txt){ const el=$(id); el.textContent=txt; el.style.display='inline-flex'; }
    function hideTags(){ ['tagCidade','tagBairro','tagServico','tagRating'].forEach(id=>$(id).style.display='none'); }
    function resetResults(){ $('results').innerHTML=''; page=1; total=0; acumulados=0; $('paginacao').style.display='none'; $('contagem').textContent=''; }

    // Card
    function cardHTML(p){
      const item = {
        id: p.id, nome: p.nome,
        servico: p.servico || p.profissao || '',
        bairro: p.bairro || '', cidade: p.cidade || '',
        foto: p.foto || '',
        rating: Number(p.rating||0), avaliacoes: Number(p.avaliacoes||0),
        precoBase: p.precoBase || p.preco || null,
        distanceKm: (p.distanceKm ?? p.dist ?? p.distanciaKm ?? null),
        lat: p.lat, lng: p.lng
      };
      // distância (fallback)
      if((item.distanceKm==null || !isFinite(item.distanceKm)) &&
         Number.isFinite(userLat) && Number.isFinite(userLng) &&
         Number.isFinite(item.lat) && Number.isFinite(item.lng)){
        try{ item.distanceKm = hav(userLat,userLng,item.lat,item.lng); }catch{}
      }
      const dist = kmFmt(item.distanceKm);
      const fotoSrc = item.foto || '/icons/icon-192.png';
      const id = encodeURIComponent(item.id);
      const local = [item.bairro, item.cidade].filter(Boolean).join(' • ');
      const price = (item.precoBase!=null && item.precoBase!=="") ? `R$ ${String(item.precoBase).toString().replace('.',',')}` : null;
      return `
        <article class="pro-card">
          <img class="pro-avatar" src="${esc(fotoSrc)}" alt="Foto de ${esc(item.nome)}"
               loading="lazy" onerror="this.src='/icons/icon-192.png'">
          <div class="pro-main">
            <h3 class="pro-name">${esc(item.nome)}</h3>
            <div class="pro-sub">
              ${esc(item.servico||'')} • <span class="muted">${esc(local||'—')}</span>
              <span class="rating"> ${estrelas(item.rating)} </span>
              <span class="muted">(${item.avaliacoes})</span>
            </div>
          </div>
          <div class="pro-right">
            <span class="dist">${dist}</span>
            ${price ? `<span class="price">${esc(price)}</span>`:''}
            <a class="btn" style="padding:6px 10px; font-size:13px; margin-top:4px" href="/profissional/${id}">Ver</a>
          </div>
        </article>
      `;
    }

    // Normaliza resposta do backend em vários formatos
    function normalizeItems(js){
      try{
        if (Array.isArray(js)) return js;
        if (js && Array.isArray(js.items)) return js.items;
        if (js && js.data && Array.isArray(js.data.items)) return js.data.items;
        if (js && Array.isArray(js.result)) return js.result;
        if (js && js.item) return [js.item];
      }catch{}
      return [];
    }

    // Busca
    async function fetchProfissionais(isLoadMore=false){
      const params = new URLSearchParams();
      if(lastQuery.cidade) params.set('cidade', lastQuery.cidade);
      if(lastQuery.bairro)  params.set('bairro', lastQuery.bairro);
      if(lastQuery.servico) params.set('servico', lastQuery.servico);
      if(lastQuery.minRating) params.set('minRating', lastQuery.minRating);
      params.set('sort','score'); params.set('dir','desc');
      params.set('page', String(page)); params.set('limit', String(limit));
      if(useGPS && userLat!=null && userLng!=null){
        params.set('userLat', String(userLat));
        params.set('userLng', String(userLng));
      }
      params.set('ts', Date.now());
      try{
        $('loader').style.display='';
        const r = await fetch('/api/profissionais?'+params.toString(), NO_STORE);
        if(!r.ok) throw new Error('HTTP '+r.status);
        const js = await r.json();
        const items = normalizeItems(js);
        total = Number(js?.total ?? items.length ?? 0);

        if(items.length===0 && !isLoadMore){
          const alt = await tryFeaturedFallback();
          if(alt && alt.length){
            renderResults(alt, false);
            acumulados = alt.length;
            $('paginacao').style.display='none';
            $('contagem').textContent='';
            return;
          }
        }

        renderResults(items, isLoadMore);
        acumulados += items.length;
        $('paginacao').style.display = (acumulados<total)?'':'none';
        $('contagem').textContent = (acumulados<total)? `${acumulados}/${total} exibidos` : '';
      }catch(e){
        console.error('Falha /api/profissionais', e);
        if(!isLoadMore){
          $('results').innerHTML = `<div class="card"><p class="err">Falha ao carregar resultados. Tente novamente.</p></div>`;
          flashErr('Erro ao buscar profissionais. Verifique sua conexão ou tente novamente mais tarde.');
        }
      }finally{
        $('loader').style.display='none';
      }
    }

    function renderResults(items, isLoadMore){
      const grid = $('results');
      const html = (items||[]).map(cardHTML).join('');
      if(isLoadMore) grid.insertAdjacentHTML('beforeend', html);
      else grid.innerHTML = html || `<div class="card"><p class="meta">Nenhum profissional encontrado com os filtros atuais.</p></div>`;
    }

    function applyStateTags(q){
      hideTags();
      if(q.cidade) showTag('tagCidade','Cidade: '+q.cidade);
      if(q.bairro) showTag('tagBairro','Bairro: '+q.bairro);
      if(q.servico) showTag('tagServico','Serviço: '+q.servico);
      if(q.minRating) showTag('tagRating','Avaliação: '+q.minRating+'+');
    }

    function submitBusca(){
      lastQuery = {
        cidade: $('cidade').value.trim(),
        bairro: $('bairro').value.trim(),
        servico: $('servico').value.trim(),
        minRating: $('minRating').value.trim()
      };
      applyStateTags(lastQuery);
      resetResults();
      fetchProfissionais(false);
    }

    document.getElementById('formBusca').addEventListener('submit', (e)=>{ e.preventDefault(); submitBusca(); });
    document.getElementById('btnLimpar').addEventListener('click', async ()=>{
      $('cidade').value=''; $('bairro').value=''; $('servico').value=''; $('minRating').value='';
      hideTags(); resetResults();
      await fillCidades(); fetchProfissionais(false);
    });
    document.getElementById('btnMais').addEventListener('click', ()=>{ if(acumulados < total){ page++; fetchProfissionais(true); } });

    // Destaques
    async function tryFeaturedFallback(){
      try{
        const url1 = `/api/profissionais?featured=1&limit=6&sort=score&dir=desc&${ts()}`;
        let r = await fetch(url1, NO_STORE);
        let js = r.ok ? await r.json() : null;
        let items = normalizeItems(js);
        if(items && items.length) return items;

        const url2 = `/api/profissionais?limit=6&sort=score&dir=desc&${ts()}`;
        r = await fetch(url2, NO_STORE);
        js = r.ok ? await r.json() : {items:[]};
        items = normalizeItems(js);
        return items || [];
      }catch{ return []; }
    }
    async function loadDestaques(){
      const cont = $('destaques');
      const count = $('destCount');
      cont.innerHTML = `<div class="muted">Carregando destaques…</div>`;
      try{
        const items = await tryFeaturedFallback();
        count.textContent = items.length ? `${items.length} selecionados` : '';
        cont.innerHTML = items.length ? items.map(cardHTML).join('') : `<div class="muted">Sem destaques no momento.</div>`;
        if($('results').children.length===0 && items.length){
          $('results').innerHTML = items.map(cardHTML).join('');
        }
      }catch{
        cont.innerHTML = `<div class="muted">Não foi possível carregar os destaques.</div>`;
      }
    }

    // Boot
    (async function init(){
      // força atualização do SW
      if('serviceWorker' in navigator){
        try{
          const regs=await navigator.serviceWorker.getRegistrations();
          regs.forEach(r=>r.update());
        }catch{}
      }
      await fillCidades();

      const u=new URL(location.href);
      const cid=u.searchParams.get('cidade')||'';
      const bai=u.searchParams.get('bairro')||'';
      const ser=u.searchParams.get('servico')||'';
      const mr =u.searchParams.get('minRating')||'';
      if(cid) { $('cidade').value=cid; await loadBairrosDaCidade(cid); }
      if(bai) $('bairro').value=bai;
      if(ser) $('servico').value=ser;
      if(mr) $('minRating').value=mr;

      submitBusca();
      loadDestaques();
    })();
  })();
  </script>

  <script>
    /* SW */
    if ('serviceWorker' in navigator){
      window.addEventListener('load', ()=>{
        navigator.serviceWorker.register('/sw.js?v=clients-2025-09-08').catch(()=>{});
      });
    }
  </script>
</body></html>