<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel do Profissional — Autônoma</title>

  <link rel="stylesheet" href="/public.css.global.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header>
  <div class="container header-content">
    <a href="/" class="logo">Autônoma</a>
    <a href="#" onclick="logout()" class="btn btn-outline">Sair</a>
  </div>
</header>

<section class="container">

  <h1>Painel do Profissional</h1>

  <!-- STATUS / PLANO -->
  <div class="grid grid-3" style="margin-top:1.5rem">

    <div class="card">
      <h3>Plano Atual</h3>
      <p id="plano">—</p>
      <p id="assinaturaStatus"></p>
      <a href="/checkout-assinatura.html" class="btn btn-primary btn-sm">Gerenciar plano</a>
    </div>

    <div class="card">
      <h3>Avaliação</h3>
      <p><strong id="avaliacao">—</strong> ⭐</p>
      <p id="totalAvaliacoes"></p>
    </div>

    <div class="card">
      <h3>Status</h3>
      <p id="statusConta"></p>
      <span id="verificadoBadge"></span>
    </div>

  </div>

  <!-- CONTROLES -->
  <div class="grid grid-2" style="margin-top:2rem">

    <div class="card">
      <h3>Modo de Atendimento</h3>

      <label class="switch">
        <input type="checkbox" id="modoRaio" onchange="toggleModoRaio()">
        <span class="slider"></span>
      </label>
      <p>Modo Raio (Premium)</p>

      <label class="switch" style="margin-top:1rem;">
        <input type="checkbox" id="modoUber" onchange="toggleModoUber()">
        <span class="slider"></span>
      </label>
      <p>Modo Uber (Atendimento imediato)</p>

    </div>

    <div class="card">
      <h3>Perfil Público</h3>
      <p>Seu perfil está visível para clientes.</p>
      <a id="linkPerfil" target="_blank" class="btn btn-outline">Ver perfil</a>
    </div>

  </div>

  <!-- VERIFICAÇÃO -->
  <div class="card" style="margin-top:2rem">
    <h3>Verificação Profissional</h3>

    <p>Status: <strong id="statusVerificacao"></strong></p>

    <form id="formDocs">
      <input type="file" required />
      <button class="btn btn-primary btn-sm">Enviar documento</button>
    </form>
  </div>

  <!-- DENÚNCIAS -->
  <div class="card" style="margin-top:2rem">
    <h3>Denúncias Recebidas</h3>
    <ul id="listaDenuncias"></ul>
  </div>

</section>

<footer>
  © 2026 Autônoma.app
</footer>

<script>
  async function carregarPainel() {
    const res = await fetch('/api/profissional/me')
    const data = await res.json()

    if (!data.ok) {
      location.href = '/Painel-login.html'
      return
    }

    const p = data.profissional

    document.getElementById('plano').innerText = p.plano
    document.getElementById('assinaturaStatus').innerText = p.assinaturaAtiva ? 'Assinatura ativa' : 'Sem assinatura'
    document.getElementById('avaliacao').innerText = p.avaliacao
    document.getElementById('totalAvaliacoes').innerText = `${p.totalAvaliacoes} avaliações`
    document.getElementById('statusConta').innerText = p.ativo ? 'Conta ativa' : 'Conta suspensa'

    document.getElementById('verificadoBadge').innerHTML =
      p.verificado ? '<span class="badge badge-verificado">✔ Verificado</span>' : 'Não verificado'

    document.getElementById('modoRaio').checked = p.modoRaio
    document.getElementById('modoUber').checked = p.modoUber

    document.getElementById('statusVerificacao').innerText =
      p.verificacaoStatus || 'Pendente'

    document.getElementById('linkPerfil').href = `/perfil.html?id=${p.id}`

    carregarDenuncias()
  }

  async function toggleModoRaio() {
    await fetch('/api/profissional/modo-raio', { method:'POST' })
  }

  async function toggleModoUber() {
    await fetch('/api/profissional/modo-uber', { method:'POST' })
  }

  async function carregarDenuncias() {
    const res = await fetch('/api/denuncias/me')
    const data = await res.json()

    const ul = document.getElementById('listaDenuncias')
    ul.innerHTML = ''

    if (!data.ok || data.denuncias.length === 0) {
      ul.innerHTML = '<li>Nenhuma denúncia</li>'
      return
    }

    data.denuncias.forEach(d => {
      const li = document.createElement('li')
      li.innerText = d.motivo
      ul.appendChild(li)
    })
  }

  function logout() {
    fetch('/api/auth/logout').then(() => location.href = '/')
  }

  carregarPainel()
</script>

</body>
</html>