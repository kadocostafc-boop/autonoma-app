<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Login do Admin • Autônoma.app</title>
  <meta name="theme-color" content="#0b1f63">
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css?v=admin-login-2025-09-08">
  <style>
    :root{
      --azul-escuro:#0b1f63;
      --azul:#2D81FF;
      --bd:#e5e7eb;
      --txt:#111827;
      --mut:#64748b;
      --ok:#16a34a;
      --err:#b91c1c;
    }
    html,body{height:100%;margin:0;background:#f5f6fa;color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .page{min-height:100vh;display:flex;flex-direction:column}
    @supports(min-height:100svh){.page{min-height:100svh}}
    /* Header compacto com fundo azul escuro (mesmo tom do site) */
    .header{background:var(--azul-escuro);color:#fff;display:flex;align-items:center;gap:12px;padding:12px 16px}
    .header .logo{height:32px;width:auto;display:block}
    .header .spacer{flex:1}
    .header .btn{border:1px solid #ffffff44;background:transparent;color:#fff;padding:8px 12px;border-radius:10px;text-decoration:none;font-weight:800;font-size:14px}
    .header .btn:hover{background:#ffffff18}
    /* Área central */
    main{flex:1;display:flex;align-items:center;justify-content:center;padding:16px}
    .wrap{width:100%;max-width:520px}
    .card{background:#fff;border:1px solid var(--bd);border-radius:16px;padding:16px}
    .title{margin:0 0 4px;font-size:22px;font-weight:900;color:#0b1f63}
    .subtitle{margin:0 0 10px;color:var(--mut);font-size:14px}
    label{font-weight:600;display:block;margin:10px 0 6px}
    .input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--bd);font-size:15px;background:#fff}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .help{color:var(--mut);font-size:13px}
    .btn-primary{border:none;background:#2D81FF;color:#fff;padding:12px 14px;border-radius:12px;cursor:pointer;font-weight:800;width:100%}
    .btn-primary:disabled{opacity:.7;cursor:not-allowed}
    .btn-ghost{border:1px solid var(--bd);background:#f8fafc;color:var(--txt);padding:10px 12px;border-radius:12px;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
    .actions{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:12px;flex-wrap:wrap}
    .msg{font-size:14px;margin-top:10px}
    .msg.ok{color:var(--ok)}
    .msg.err{color:#b91c1c}
    /* Toggle mostrar senha dentro do input */
    .field-wrap{position:relative}
    .toggle-pass{position:absolute;right:8px;top:50%;transform:translateY(-50%);border:1px solid var(--bd);background:#f8fafc;border-radius:10px;padding:6px 8px;font-size:12px;cursor:pointer}
    /* Rodapé mínimo */
    footer{background:#0b1f63;color:#cde1ff;padding:10px 8px}
    .foot-links{display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
    .foot-links a{color:#cde1ff;font-size:13px;text-decoration:none}
    .foot-links a:hover{text-decoration:underline}
    .copy{ text-align:center;font-size:11.5px;color:#b8cffc;margin-top:4px }
    /* Acessibilidade ao focar */
    a:focus, button:focus, input:focus{outline:3px solid #a5b4fc;outline-offset:2px}
    /* Mobile refinements */
    @media (max-width:420px){
      .title{font-size:20px}
      .btn-primary{padding:13px}
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Header -->
    <header class="header" role="banner" aria-label="Cabeçalho">
      <a href="/" aria-label="Início">
        <img src="/img/logo.png" alt="Autônoma.app" class="logo" onerror="this.style.display='none'">
      </a>
      <div class="spacer"></div>
      <a class="btn" href="/clientes.html">Buscar</a>
    </header>
    <!-- Main -->
    <main role="main">
      <div class="wrap">
        <div class="card" role="form" aria-labelledby="t">
          <h1 id="t" class="title">Entrar • Admin</h1>
          <p class="subtitle">Acesso ao painel administrativo do Autônoma.app</p>
          <form id="f" novalidate>
            <label for="email">E-mail</label>
            <input id="email" name="email" type="email" class="input" autocomplete="username" inputmode="email" placeholder="admin@exemplo.com" required>
            <label for="pass">Senha</label>
            <div class="field-wrap">
              <input id="pass" name="password" type="password" class="input" autocomplete="current-password" placeholder="••••••••" required>
              <button type="button" id="togglePass" class="toggle-pass" aria-pressed="false" aria-controls="pass">Mostrar</button>
            </div>
            <div class="row" style="justify-content:space-between;margin-top:8px">
              <label class="row" style="gap:6px;cursor:pointer">
                <input id="remember" type="checkbox" style="accent-color:#2D81FF">
                <span class="help">Manter conectado</span>
              </label>
              <a class="help" href="/admin/recuperar" rel="nofollow">Esqueci minha senha</a>
            </div>
            <button id="btn" class="btn-primary" type="submit">Entrar</button>
            <p id="status" class="msg" aria-live="polite"></p>
          </form>
          <div class="actions">
            <a class="btn-ghost" href="/">← Voltar ao início</a>
            <span class="help">Precisa de acesso? Contate o responsável.</span>
          </div>
        </div>
      </div>
    </main>
    <!-- Footer -->
    <footer role="contentinfo">
      <nav class="foot-links" aria-label="Links do rodapé">
        <a href="/termos.html">Termos</a>
        <a href="/privacidade.html">Privacidade</a>
        <a href="/top10.html">Top 10</a>
        <a href="/planos.html">Planos</a>
        <a href="/politica-de-seguranca.html">Segurança</a>
        <a href="/favoritos.html">Favoritos</a>
      </nav>
      <div class="copy">© 2025 Autônoma.app — Admin</div>
    </footer>
  </div>
  <script>
  (function(){
    const $ = (s)=> document.querySelector(s);
    const f = $('#f'), email=$('#email'), pass=$('#pass'), btn=$('#btn'), status=$('#status');
    const toggle = $('#togglePass');

    // Acessibilidade + UX
    email.focus({ preventScroll:true });
    toggle.addEventListener('click', ()=>{
      const type = pass.getAttribute('type') === 'password' ? 'text' : 'password';
      pass.setAttribute('type', type);
      toggle.textContent = type === 'password' ? 'Mostrar' : 'Ocultar';
      toggle.setAttribute('aria-pressed', type === 'text' ? 'true' : 'false');
    });

    function setStatus(msg, kind){
      status.textContent = msg || '';
      status.className = 'msg ' + (kind || '');
    }

    async function login(ev){
      ev.preventDefault();
      const emailVal = String(email.value||'').trim();
      const passVal  = String(pass.value||'').trim();
      if(!emailVal || !passVal){
        setStatus('Informe e-mail e senha.', 'err');
        return;
      }
      btn.disabled = true; setStatus('Entrando...', '');
      try{
        const r = await fetch('/admin/login', {
          method: 'POST',
          headers: { 'Content-Type':'application/json' },
          body: JSON.stringify({
            email: emailVal,
            password: passVal,
            remember: $('#remember').checked === true
          }),
          credentials: 'include',
          cache: 'no-store'
        });
        if (r.ok){
          setStatus('✔ Acesso autorizado. Redirecionando...', 'ok');
          // REDIRECIONA PARA O ARQUIVO admin.html (corrigido)
          setTimeout(()=>{ window.location.href = '/admin.html'; }, 300);
          return;
        }
        if (r.status === 401){
          setStatus('Credenciais inválidas.', 'err');
        } else if (r.status === 429){
          setStatus('Muitas tentativas. Aguarde um momento e tente novamente.', 'err');
        } else {
          setStatus('Falha no login. Tente novamente.', 'err');
        }
      }catch(_){
        setStatus('Sem conexão ou servidor indisponível.', 'err');
      }finally{
        btn.disabled = false;
      }
    }

    f.addEventListener('submit', login);

    // Service Worker
    if ('serviceWorker' in navigator){
      window.addEventListener('load', ()=>{
        navigator.serviceWorker.register('/sw.js?v=admin-login-2025-09-08').catch(()=>{});
      });
      let reloaded=false;
      navigator.serviceWorker.addEventListener('controllerchange', ()=>{
        if(!reloaded){ reloaded=true; location.reload(); }
      });
    }
  })();
  </script>
</body>
</html>