generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// ////////////////////////////////////////////////////////////
/// ////////////////////////////////////////////////////////////
model Usuario {
  id           Int           @id @default(autoincrement())
  nome         String
  email        String        @unique
  senha        String
  tipo         String
  criadoEm     DateTime      @default(now())
  profissional Profissional?
}

/// ////////////////////////////////////////////////////////////
/// ////////////////////////////////////////////////////////////
model Profissional {
  id               Int         @id @default(autoincrement())
  usuarioId        Int         @unique
  nome             String
  idade            Int
  tempoExperiencia Int
  fotoUrl          String?
  descricao        String?
  criadoEm         DateTime    @default(now())
  avaliacoes       Avaliacao[]
  endereco         Endereco?
  mensagens        Mensagem[]
  usuario          Usuario     @relation(fields: [usuarioId], references: [id])
  servicos         Servico[]
}

/// ////////////////////////////////////////////////////////////
/// ////////////////////////////////////////////////////////////
model Endereco {
  id             Int          @id @default(autoincrement())
  profissionalId Int          @unique
  cidade         String
  bairro         String
  estado         String
  latitude       Float?
  longitude      Float?
  profissional   Profissional @relation(fields: [profissionalId], references: [id])
}

/// ////////////////////////////////////////////////////////////
/// ////////////////////////////////////////////////////////////
model Categoria {
  id       Int       @id @default(autoincrement())
  nome     String    @unique
  servicos Servico[]
}

/// ////////////////////////////////////////////////////////////
/// ////////////////////////////////////////////////////////////
model Servico {
  id             Int          @id @default(autoincrement())
  profissionalId Int
  categoriaId    Int
  titulo         String
  descricao      String
  preco          Float
  publicado      Boolean      @default(true)
  criadoEm       DateTime     @default(now())
  categoria      Categoria    @relation(fields: [categoriaId], references: [id])
  profissional   Profissional @relation(fields: [profissionalId], references: [id])
}

/// ////////////////////////////////////////////////////////////
/// ////////////////////////////////////////////////////////////
model Avaliacao {
  id             Int          @id @default(autoincrement())
  profissionalId Int
  nota           Int
  comentario     String?
  clienteNome    String
  criadoEm       DateTime     @default(now())
  profissional   Profissional @relation(fields: [profissionalId], references: [id])
}

/// ////////////////////////////////////////////////////////////
/// ////////////////////////////////////////////////////////////
model Mensagem {
  id             Int          @id @default(autoincrement())
  profissionalId Int
  nomeCliente    String
  contato        String
  mensagem       String
  respondido     Boolean      @default(false)
  criadoEm       DateTime     @default(now())
  profissional   Profissional @relation(fields: [profissionalId], references: [id])
}

/// ////////////////////////////////////////////////////////////
/// ////////////////////////////////////////////////////////////
model Assinatura {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  plano     String
  ativo     Boolean  @default(true)
  criadoEm  DateTime @default(now())
}

model ResetToken {
  token     String   @id
  userId    Int
  expiresAt DateTime @map("expires_at")

  @@map("reset_tokens")
}

model session {
  sid    String   @id @db.VarChar
  sess   Json     @db.Json
  expire DateTime @db.Timestamp(6)

  @@index([expire], map: "IDX_session_expire")
}
