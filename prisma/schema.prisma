// ======================================================================
// AUTÔNOMA.APP — SCHEMA.PRISMA (FINAL / PRODUÇÃO)
// Login • Geo • Serviços • Planos • Asaas • Admin • Verificação
// ======================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ======================================================================
// ENUMS
// ======================================================================

enum Plano {
  FREE
  PRO
  PREMIUM
}

enum StatusAssinatura {
  PENDENTE
  ATIVA
  CANCELADA
}

enum StatusVerificacao {
  PENDENTE
  APROVADO
  REJEITADO
}

// ======================================================================
// MODELS
// ======================================================================

model Profissional {
  id                   String   @id @default(uuid())
  nome                 String
  email                String   @unique
  whatsapp             String   @unique
  senha                String

  foto                 String?
  bio                  String?

  cidade               String
  estado               String
  bairro               String?

  latitude             Float?
  longitude            Float?

  plano                Plano              @default(FREE)
  planoSolicitado      Plano?
  statusAssinatura     StatusAssinatura   @default(PENDENTE)
  taxaPlataforma       Float              @default(0)

  asaasCustomerId      String?
  asaasSubscriptionId  String?

  modoRaioAtivo        Boolean            @default(false)
  ativo                Boolean            @default(true)

  verificado           Boolean            @default(false)
  statusVerificacao    StatusVerificacao  @default(PENDENTE)
  documentoVerificacao String?

  resetToken           String?
  resetTokenExpires    DateTime?

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // RELAÇÕES
  servicos             ProfissionalServico[]
  avaliacoes           Avaliacao[]
  denuncias            Denuncia[]
  pagamentos           Pagamento[]
}

// ----------------------------------------------------------------------

model Servico {
  id        String   @id @default(uuid())
  nome      String   @unique
  slug      String   @unique
  ativo     Boolean  @default(true)

  createdAt DateTime @default(now())

  profissionais ProfissionalServico[]
}

// ----------------------------------------------------------------------

model ProfissionalServico {
  id              String @id @default(uuid())
  profissionalId  String
  servicoId       String

  profissional    Profissional @relation(fields: [profissionalId], references: [id], onDelete: Cascade)
  servico          Servico      @relation(fields: [servicoId], references: [id], onDelete: Cascade)

  @@unique([profissionalId, servicoId])
}

// ----------------------------------------------------------------------

model Avaliacao {
  id              String   @id @default(uuid())
  profissionalId  String
  nota            Int
  comentario      String?

  createdAt       DateTime @default(now())

  profissional    Profissional @relation(fields: [profissionalId], references: [id], onDelete: Cascade)
}

// ----------------------------------------------------------------------

model Denuncia {
  id              String   @id @default(uuid())
  profissionalId  String
  motivo          String

  cidade          String?
  estado          String?

  createdAt       DateTime @default(now())

  profissional    Profissional @relation(fields: [profissionalId], references: [id], onDelete: Cascade)
}

// ----------------------------------------------------------------------
// FINANCEIRO (PRONTO PARA ASAAS)
// ----------------------------------------------------------------------

model Pagamento {
  id              String   @id @default(uuid())
  profissionalId  String

  valor           Float
  taxaPlataforma  Float
  plano           Plano

  asaasPaymentId  String?
  status          String

  createdAt       DateTime @default(now())

  profissional    Profissional @relation(fields: [profissionalId], references: [id], onDelete: Cascade)
}
