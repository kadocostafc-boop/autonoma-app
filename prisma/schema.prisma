// ======================================================================
// AUTÔNOMA.APP — SCHEMA.PRISMA (FINAL)
// Compatível com login, geo, planos, Asaas, admin e verificação
// ======================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ======================================================================
// ENUMS
// ======================================================================

enum Plano {
  FREE
  PRO
  PREMIUM
}

enum StatusAssinatura {
  PENDENTE
  ATIVA
  CANCELADA
}

enum StatusVerificacao {
  PENDENTE
  APROVADO
  REJEITADO
}

// ======================================================================
// PROFISSIONAL
// ======================================================================

model Profissional {
  id                   String   @id @default(uuid())
  nome                 String
  email                String   @unique
  whatsapp             String   @unique
  senha                String

  bio                  String?
  foto                 String?

  servicos             String[]
  cidade               String
  estado               String
  bairro               String?

  latitude             Float?
  longitude            Float?

  plano                Plano            @default(FREE)
  planoSolicitado      Plano?
  statusAssinatura     StatusAssinatura  @default(PENDENTE)
  asaasCustomerId      String?
  asaasSubscriptionId  String?
  taxaPlataforma       Float             @default(0)
  modoRaioAtivo        Boolean           @default(false)

  ativo                Boolean           @default(true)
  verificado           Boolean           @default(false)
  statusVerificacao    StatusVerificacao @default(PENDENTE)
  documentoVerificacao String?

  resetToken           String?
  resetTokenExpires    DateTime?

  avaliacoes           Avaliacao[]
  denuncias            Denuncia[]

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

// ======================================================================
// AVALIAÇÃO
// ======================================================================

model Avaliacao {
  id              String   @id @default(uuid())
  profissionalId  String
  nota            Int
  comentario      String?

  profissional    Profissional @relation(fields: [profissionalId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())
}

// ======================================================================
// DENÚNCIA
// ======================================================================

model Denuncia {
  id              String   @id @default(uuid())
  profissionalId  String
  motivo          String

  profissional    Profissional @relation(fields: [profissionalId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now())
}